{% extends "base.html" %}

{% block title %}User List{% endblock %}

{% block content %}
  <h1>All Users</h1>

  <div id="message"></div>

  {% if users %}
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr id="user-{{ user[0] }}">
        <td>{{ user[0] }}</td>
        <td>{{ user[1] }}</td>
        <td>{{ user[2] }}</td>
        <td><button onclick="deleteUser({{ user[0] }})">Delete</button></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No users found.</p>
  {% endif %}

  <script>
    function showMessage(text, type = 'success') {
      const msg = document.getElementById('message');
      msg.textContent = text;
      msg.className = `show ${type}`;
      setTimeout(() => { msg.classList.remove('show'); }, 3000);
    }

    async function deleteUser(id) {
      if (!confirm('Are you sure you want to delete this user?')) return;

      const res = await fetch(`/api/users/${id}`, { method: 'DELETE' });
      const data = await res.json();

      if (res.ok) {
        document.getElementById(`user-${id}`).remove();
        showMessage(data.message, 'success');
      } else {
        showMessage(data.error || 'Failed to delete user', 'error');
      }
    }
  </script>
{% endblock %}